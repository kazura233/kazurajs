"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1698],{6099:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"web-postmsg","title":"Web PostMsg","description":"Web PostMsg \u662f\u4e00\u4e2a\u7528\u4e8e Web \u73af\u5883\u4e0b\u7684 postMessage \u901a\u4fe1\u5de5\u5177\u5305\uff0c\u63d0\u4f9b\u4e86\u7b80\u5355\u6613\u7528\u7684 API \u548c\u7c7b\u578b\u5b89\u5168\u7684\u6d88\u606f\u5904\u7406\u3002","source":"@site/docs/web-postmsg.md","sourceDirName":".","slug":"/web-postmsg","permalink":"/kazurajs/docs/web-postmsg","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/web-postmsg.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"Web Daemon","permalink":"/kazurajs/docs/web-daemon"},"next":{"title":"PostMsg Builder","permalink":"/kazurajs/docs/postmsg-builder"}}');var i=s(6106),r=s(8784);const c={sidebar_position:11},d="Web PostMsg",t={},o=[{value:"\u7279\u6027",id:"\u7279\u6027",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:2},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:3},{value:"\u8de8\u7a97\u53e3\u901a\u4fe1",id:"\u8de8\u7a97\u53e3\u901a\u4fe1",level:3},{value:"\u63a5\u6536\u6240\u6709\u901a\u9053\u7684\u6d88\u606f",id:"\u63a5\u6536\u6240\u6709\u901a\u9053\u7684\u6d88\u606f",level:3},{value:"API \u53c2\u8003",id:"api-\u53c2\u8003",level:2},{value:"WebPostMsg \u6784\u9020\u51fd\u6570",id:"webpostmsg-\u6784\u9020\u51fd\u6570",level:3},{value:"\u5b9e\u4f8b\u65b9\u6cd5",id:"\u5b9e\u4f8b\u65b9\u6cd5",level:3},{value:"emit",id:"emit",level:4},{value:"on",id:"on",level:4},{value:"off",id:"off",level:4},{value:"destroy",id:"destroy",level:4},{value:"\u9759\u6001\u5c5e\u6027",id:"\u9759\u6001\u5c5e\u6027",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2},{value:"\u5f02\u6b65\u6d88\u606f\u5904\u7406",id:"\u5f02\u6b65\u6d88\u606f\u5904\u7406",level:3},{value:"\u591a\u901a\u9053\u901a\u4fe1",id:"\u591a\u901a\u9053\u901a\u4fe1",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"web-postmsg",children:"Web PostMsg"})}),"\n",(0,i.jsx)(n.p,{children:"Web PostMsg \u662f\u4e00\u4e2a\u7528\u4e8e Web \u73af\u5883\u4e0b\u7684 postMessage \u901a\u4fe1\u5de5\u5177\u5305\uff0c\u63d0\u4f9b\u4e86\u7b80\u5355\u6613\u7528\u7684 API \u548c\u7c7b\u578b\u5b89\u5168\u7684\u6d88\u606f\u5904\u7406\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u7279\u6027",children:"\u7279\u6027"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u7b80\u5355\u6613\u7528\u7684 postMessage \u901a\u4fe1 API"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u6d88\u606f\u901a\u9053\uff08channel\uff09\u7ba1\u7406"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u6d88\u606f\u8d85\u65f6\u5904\u7406\uff08\u9ed8\u8ba4 5 \u79d2\uff09"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301 Promise \u98ce\u683c\u7684\u6d88\u606f\u54cd\u5e94"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u6d88\u606f UUID \u8ffd\u8e2a"}),"\n",(0,i.jsx)(n.li,{children:"\u652f\u6301\u8de8\u7a97\u53e3\u901a\u4fe1"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install @kazura/web-postmsg\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,i.jsx)(n.h3,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import WebPostMsg from '@kazura/web-postmsg'\n\n// \u521b\u5efa\u53d1\u9001\u65b9\nconst sender = new WebPostMsg({\n  receiver: window.parent,\n  channel: 'main',\n})\n\n// \u521b\u5efa\u63a5\u6536\u65b9\nconst receiver = new WebPostMsg({\n  receiver: window,\n  channel: 'main',\n})\n\n// \u53d1\u9001\u6d88\u606f\nsender.emit('greeting', { message: 'Hello' }).then((response) => {\n  console.log('Response:', response)\n})\n\n// \u63a5\u6536\u6d88\u606f\nreceiver.on('greeting', (data) => {\n  console.log(data.message) // 'Hello'\n  return { status: 'received' } // \u8fd4\u56de\u54cd\u5e94\u6570\u636e\n})\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u8de8\u7a97\u53e3\u901a\u4fe1",children:"\u8de8\u7a97\u53e3\u901a\u4fe1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// \u7236\u7a97\u53e3\nconst parent = new WebPostMsg({\n  receiver: window.frames[0],\n  channel: 'parent-child',\n})\n\n// \u5b50\u7a97\u53e3\nconst child = new WebPostMsg({\n  receiver: window.parent,\n  channel: 'parent-child',\n})\n\n// \u7236\u7a97\u53e3\u53d1\u9001\u6d88\u606f\nparent.emit('parentMessage', { data: 'from parent' }).then((response) => {\n  console.log('Child response:', response)\n})\n\n// \u5b50\u7a97\u53e3\u63a5\u6536\u6d88\u606f\nchild.on('parentMessage', (data) => {\n  console.log('Received from parent:', data)\n  return { status: 'received' }\n})\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u63a5\u6536\u6240\u6709\u901a\u9053\u7684\u6d88\u606f",children:"\u63a5\u6536\u6240\u6709\u901a\u9053\u7684\u6d88\u606f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const receiver = new WebPostMsg({\n  receiver: window,\n  channel: 'main',\n  receiveAllChannel: true, // \u63a5\u6536\u6240\u6709\u901a\u9053\u7684\u6d88\u606f\n})\n\nreceiver.on('anyChannelMessage', (data) => {\n  console.log('Received message from any channel:', data)\n})\n"})}),"\n",(0,i.jsx)(n.h2,{id:"api-\u53c2\u8003",children:"API \u53c2\u8003"}),"\n",(0,i.jsx)(n.h3,{id:"webpostmsg-\u6784\u9020\u51fd\u6570",children:"WebPostMsg \u6784\u9020\u51fd\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"constructor(options: {\n  receiver: Window\n  channel: string\n  listeners?: Map<string, Listener>\n  receiveAllChannel?: boolean\n  self?: Window\n})\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u521b\u5efa\u4e00\u4e2a WebPostMsg \u5b9e\u4f8b\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"options.receiver"}),": \u76ee\u6807\u7a97\u53e3"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"options.channel"}),": \u6d88\u606f\u901a\u9053\u540d\u79f0"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"options.listeners"}),": \u53ef\u9009\u7684\u521d\u59cb\u76d1\u542c\u5668\u6620\u5c04"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"options.receiveAllChannel"}),": \u662f\u5426\u63a5\u6536\u6240\u6709\u901a\u9053\u7684\u6d88\u606f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"options.self"}),": \u53ef\u9009\u7684\u81ea\u8eab\u7a97\u53e3\u5f15\u7528\uff08\u9ed8\u8ba4\u4e3a window\uff09"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5b9e\u4f8b\u65b9\u6cd5",children:"\u5b9e\u4f8b\u65b9\u6cd5"}),"\n",(0,i.jsx)(n.h4,{id:"emit",children:"emit"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"emit(type: string, resources: any): Promise<any>\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u53d1\u9001\u6d88\u606f\u5e76\u7b49\u5f85\u54cd\u5e94\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"}),": \u6d88\u606f\u7c7b\u578b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"resources"}),": \u6d88\u606f\u6570\u636e"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Promise \u5305\u88c5\u7684\u54cd\u5e94\u6570\u636e"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"on",children:"on"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"on(type: string, listener: (resources: any, event: MessageEvent) => any): void\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u518c\u6d88\u606f\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"}),": \u6d88\u606f\u7c7b\u578b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"listener"}),": \u6d88\u606f\u5904\u7406\u51fd\u6570\uff0c\u53ef\u4ee5\u8fd4\u56de\u54cd\u5e94\u6570\u636e"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"off",children:"off"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"off(type: string): void\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u79fb\u9664\u6d88\u606f\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"}),": \u6d88\u606f\u7c7b\u578b"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"destroy",children:"destroy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"destroy(): void\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u9500\u6bc1\u5b9e\u4f8b\uff0c\u79fb\u9664\u6240\u6709\u4e8b\u4ef6\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u9759\u6001\u5c5e\u6027",children:"\u9759\u6001\u5c5e\u6027"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MESSAGE_TAG"}),": \u6d88\u606f\u6807\u7b7e\uff0c\u7528\u4e8e\u6807\u8bc6\u6d88\u606f\u7c7b\u578b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PREFIX_DEFAULT"}),": \u9ed8\u8ba4\u6d88\u606f\u7c7b\u578b\u524d\u7f00"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PREFIX_INTERNAL"}),": \u5185\u90e8\u6d88\u606f\u7c7b\u578b\u524d\u7f00"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"REPLY_TYPE"}),": \u56de\u590d\u6d88\u606f\u7c7b\u578b"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u6d88\u606f\u5904\u7406\u51fd\u6570\u53ef\u4ee5\u8fd4\u56de\u666e\u901a\u503c\u6216 Promise\uff0c\u8fd4\u56de\u503c\u5c06\u4f5c\u4e3a\u54cd\u5e94\u53d1\u9001\u7ed9\u53d1\u9001\u65b9"}),"\n",(0,i.jsx)(n.li,{children:"\u6d88\u606f\u8d85\u65f6\u65f6\u95f4\u9ed8\u8ba4\u4e3a 5 \u79d2"}),"\n",(0,i.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"destroy()"})," \u65b9\u6cd5\u6e05\u7406\u5b9e\u4f8b\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f"]}),"\n",(0,i.jsx)(n.li,{children:"\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e channel \u4ee5\u533a\u5206\u4e0d\u540c\u7684\u6d88\u606f\u901a\u9053"}),"\n",(0,i.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"receiveAllChannel"})," \u9009\u9879\u53ef\u4ee5\u63a5\u6536\u6240\u6709\u901a\u9053\u7684\u6d88\u606f"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,i.jsx)(n.h3,{id:"\u5f02\u6b65\u6d88\u606f\u5904\u7406",children:"\u5f02\u6b65\u6d88\u606f\u5904\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const receiver = new WebPostMsg({\n  receiver: window,\n  channel: 'main',\n})\n\nreceiver.on('asyncTask', async (data) => {\n  // \u5f02\u6b65\u5904\u7406\u6d88\u606f\n  const result = await someAsyncOperation(data)\n  return result // \u8fd4\u56de\u5904\u7406\u7ed3\u679c\n})\n\n// \u53d1\u9001\u65b9\nsender.emit('asyncTask', { task: 'process' }).then((result) => {\n  console.log('Task result:', result)\n})\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u591a\u901a\u9053\u901a\u4fe1",children:"\u591a\u901a\u9053\u901a\u4fe1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// \u521b\u5efa\u591a\u4e2a\u901a\u9053\u7684\u5b9e\u4f8b\nconst channelA = new WebPostMsg({\n  receiver: window.parent,\n  channel: 'channelA',\n})\n\nconst channelB = new WebPostMsg({\n  receiver: window.parent,\n  channel: 'channelB',\n})\n\n// \u5728\u4e0d\u540c\u901a\u9053\u4e0a\u53d1\u9001\u6d88\u606f\nchannelA.emit('message', { channel: 'A' })\nchannelB.emit('message', { channel: 'B' })\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8784:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>d});var l=s(7378);const i={},r=l.createContext(i);function c(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);