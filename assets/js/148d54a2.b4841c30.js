"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7478],{5146:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"googleapis","title":"Google APIs","description":"Google APIs \u662f\u4e00\u4e2a\u7528\u4e8e\u96c6\u6210 Google \u670d\u52a1\u7684\u5de5\u5177\u5305\uff0c\u76ee\u524d\u652f\u6301 Google OAuth2 \u8ba4\u8bc1\u548c reCAPTCHA \u9a8c\u8bc1\u3002","source":"@site/docs/googleapis.md","sourceDirName":".","slug":"/googleapis","permalink":"/kazurajs/docs/googleapis","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/googleapis.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20},"sidebar":"tutorialSidebar","previous":{"title":"HTTP Client","permalink":"/kazurajs/docs/http-client"},"next":{"title":"Validator","permalink":"/kazurajs/docs/validator"}}');var l=r(6106),i=r(1427);const o={sidebar_position:20},c="Google APIs",t={},d=[{value:"\u7279\u6027",id:"\u7279\u6027",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:2},{value:"Google OAuth2",id:"google-oauth2",level:3},{value:"Google reCAPTCHA",id:"google-recaptcha",level:3},{value:"API \u53c2\u8003",id:"api-\u53c2\u8003",level:2},{value:"GoogleOAuth2",id:"googleoauth2",level:3},{value:"\u6784\u9020\u51fd\u6570",id:"\u6784\u9020\u51fd\u6570",level:4},{value:"\u65b9\u6cd5",id:"\u65b9\u6cd5",level:4},{value:"generateAuthUrl",id:"generateauthurl",level:5},{value:"getUserInfo",id:"getuserinfo",level:5},{value:"GoogleCaptcha",id:"googlecaptcha",level:3},{value:"\u6784\u9020\u51fd\u6570",id:"\u6784\u9020\u51fd\u6570-1",level:4},{value:"\u65b9\u6cd5",id:"\u65b9\u6cd5-1",level:4},{value:"verify",id:"verify",level:5},{value:"\u7c7b\u578b\u5b9a\u4e49",id:"\u7c7b\u578b\u5b9a\u4e49",level:2},{value:"VerifyResponseErrorCode",id:"verifyresponseerrorcode",level:3},{value:"VerifyResponse",id:"verifyresponse",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2},{value:"OAuth2 \u767b\u5f55\u6d41\u7a0b",id:"oauth2-\u767b\u5f55\u6d41\u7a0b",level:3},{value:"reCAPTCHA \u9a8c\u8bc1",id:"recaptcha-\u9a8c\u8bc1",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"google-apis",children:"Google APIs"})}),"\n",(0,l.jsx)(n.p,{children:"Google APIs \u662f\u4e00\u4e2a\u7528\u4e8e\u96c6\u6210 Google \u670d\u52a1\u7684\u5de5\u5177\u5305\uff0c\u76ee\u524d\u652f\u6301 Google OAuth2 \u8ba4\u8bc1\u548c reCAPTCHA \u9a8c\u8bc1\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u7279\u6027",children:"\u7279\u6027"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u652f\u6301 Google OAuth2 \u8ba4\u8bc1"}),"\n",(0,l.jsx)(n.li,{children:"\u652f\u6301 reCAPTCHA \u9a8c\u8bc1"}),"\n",(0,l.jsx)(n.li,{children:"\u63d0\u4f9b\u5b8c\u6574\u7684 TypeScript \u7c7b\u578b\u652f\u6301"}),"\n",(0,l.jsx)(n.li,{children:"\u57fa\u4e8e\u5b98\u65b9\u7684 Google APIs \u5ba2\u6237\u7aef\u5e93"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install @kazura/googleapis\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.h3,{id:"google-oauth2",children:"Google OAuth2"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"import { GoogleOAuth2 } from '@kazura/googleapis'\n\n// \u521b\u5efa OAuth2 \u5ba2\u6237\u7aef\nconst oauth2 = new GoogleOAuth2({\n  clientId: 'your-client-id',\n  clientSecret: 'your-client-secret',\n  redirectUri: 'your-redirect-uri',\n})\n\n// \u751f\u6210\u8ba4\u8bc1 URL\nconst authUrl = oauth2.generateAuthUrl({\n  scope: ['profile', 'email'],\n  access_type: 'offline',\n})\n\n// \u83b7\u53d6\u7528\u6237\u4fe1\u606f\nconst userInfo = await oauth2.getUserInfo({\n  code: 'authorization-code',\n})\n"})}),"\n",(0,l.jsx)(n.h3,{id:"google-recaptcha",children:"Google reCAPTCHA"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"import { GoogleCaptcha } from '@kazura/googleapis'\n\n// \u521b\u5efa reCAPTCHA \u9a8c\u8bc1\u5668\nconst captcha = new GoogleCaptcha('your-secret-key')\n\n// \u9a8c\u8bc1 token\nconst result = await captcha.verify('user-response-token', 'user-ip-address')\nif (result.success) {\n  console.log('\u9a8c\u8bc1\u6210\u529f')\n} else {\n  console.log('\u9a8c\u8bc1\u5931\u8d25:', result['error-codes'])\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"api-\u53c2\u8003",children:"API \u53c2\u8003"}),"\n",(0,l.jsx)(n.h3,{id:"googleoauth2",children:"GoogleOAuth2"}),"\n",(0,l.jsx)(n.h4,{id:"\u6784\u9020\u51fd\u6570",children:"\u6784\u9020\u51fd\u6570"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"constructor(options: OAuth2ClientOptions)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"options"}),": OAuth2 \u5ba2\u6237\u7aef\u914d\u7f6e","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"clientId"}),": \u5ba2\u6237\u7aef ID"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"clientSecret"}),": \u5ba2\u6237\u7aef\u5bc6\u94a5"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"redirectUri"}),": \u91cd\u5b9a\u5411 URI"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u65b9\u6cd5",children:"\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.h5,{id:"generateauthurl",children:"generateAuthUrl"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"generateAuthUrl(opts?: GenerateAuthUrlOpts): string\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u751f\u6210 OAuth2 \u8ba4\u8bc1 URL\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"opts"}),": \u8ba4\u8bc1 URL \u751f\u6210\u9009\u9879","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"scope"}),": \u8bf7\u6c42\u7684\u6743\u9650\u8303\u56f4"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"access_type"}),": \u8bbf\u95ee\u7c7b\u578b"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"prompt"}),": \u63d0\u793a\u7c7b\u578b"]}),"\n",(0,l.jsx)(n.li,{children:"\u5176\u4ed6\u9009\u9879..."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8ba4\u8bc1 URL \u5b57\u7b26\u4e32"}),"\n"]}),"\n",(0,l.jsx)(n.h5,{id:"getuserinfo",children:"getUserInfo"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"async getUserInfo(options: GetTokenOptions): Promise<UserInfo>\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"options"}),": \u83b7\u53d6\u4ee4\u724c\u7684\u9009\u9879","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"code"}),": \u6388\u6743\u7801"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"redirect_uri"}),": \u91cd\u5b9a\u5411 URI"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7528\u6237\u4fe1\u606f\u5bf9\u8c61"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"googlecaptcha",children:"GoogleCaptcha"}),"\n",(0,l.jsx)(n.h4,{id:"\u6784\u9020\u51fd\u6570-1",children:"\u6784\u9020\u51fd\u6570"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"constructor(secret: string)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"secret"}),": reCAPTCHA \u5bc6\u94a5"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u65b9\u6cd5-1",children:"\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.h5,{id:"verify",children:"verify"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"async verify(token: string, remoteip?: string): Promise<VerifyResponse>\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u9a8c\u8bc1 reCAPTCHA token\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"token"}),": \u7528\u6237\u54cd\u5e94 token"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"remoteip"}),": \u7528\u6237 IP \u5730\u5740\uff08\u53ef\u9009\uff09"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u9a8c\u8bc1\u54cd\u5e94\u5bf9\u8c61","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"success"}),": \u662f\u5426\u9a8c\u8bc1\u6210\u529f"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"challenge_ts"}),": \u6311\u6218\u65f6\u95f4\u6233"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"hostname"}),": \u4e3b\u673a\u540d"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"error-codes"}),": \u9519\u8bef\u4ee3\u7801\u6570\u7ec4\uff08\u5982\u679c\u9a8c\u8bc1\u5931\u8d25\uff09"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u7c7b\u578b\u5b9a\u4e49",children:"\u7c7b\u578b\u5b9a\u4e49"}),"\n",(0,l.jsx)(n.h3,{id:"verifyresponseerrorcode",children:"VerifyResponseErrorCode"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"type VerifyResponseErrorCode =\n  | 'missing-input-secret' // \u7f3a\u5c11\u5bc6\u94a5\u53c2\u6570\n  | 'invalid-input-secret' // \u5bc6\u94a5\u53c2\u6570\u65e0\u6548\u6216\u683c\u5f0f\u9519\u8bef\n  | 'missing-input-response' // \u7f3a\u5c11\u54cd\u5e94\u53c2\u6570\n  | 'invalid-input-response' // \u54cd\u5e94\u53c2\u6570\u65e0\u6548\u6216\u683c\u5f0f\u9519\u8bef\n  | 'bad-request' // \u8bf7\u6c42\u65e0\u6548\u6216\u683c\u5f0f\u9519\u8bef\n  | 'timeout-or-duplicate' // \u54cd\u5e94\u5df2\u8fc7\u671f\u6216\u5df2\u88ab\u4f7f\u7528\n"})}),"\n",(0,l.jsx)(n.h3,{id:"verifyresponse",children:"VerifyResponse"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"interface VerifyResponse {\n  success: boolean\n  challenge_ts: string\n  hostname: string\n  'error-codes': VerifyResponseErrorCode[]\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528 OAuth2 \u65f6\uff0c\u9700\u8981\u5148\u5728 Google Cloud Console \u521b\u5efa\u9879\u76ee\u5e76\u914d\u7f6e OAuth2 \u51ed\u636e"}),"\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528 reCAPTCHA \u65f6\uff0c\u9700\u8981\u5148\u5728 Google reCAPTCHA \u7ba1\u7406\u63a7\u5236\u53f0\u6ce8\u518c\u7ad9\u70b9"}),"\n",(0,l.jsx)(n.li,{children:"\u8bf7\u59a5\u5584\u4fdd\u7ba1\u5ba2\u6237\u7aef\u5bc6\u94a5\u548c reCAPTCHA \u5bc6\u94a5"}),"\n",(0,l.jsx)(n.li,{children:"\u5efa\u8bae\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u5b58\u50a8\u654f\u611f\u4fe1\u606f"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,l.jsx)(n.h3,{id:"oauth2-\u767b\u5f55\u6d41\u7a0b",children:"OAuth2 \u767b\u5f55\u6d41\u7a0b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"import { GoogleOAuth2 } from '@kazura/googleapis'\n\nconst oauth2 = new GoogleOAuth2({\n  clientId: process.env.GOOGLE_CLIENT_ID,\n  clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n  redirectUri: process.env.GOOGLE_REDIRECT_URI,\n})\n\n// 1. \u751f\u6210\u8ba4\u8bc1 URL\nconst authUrl = oauth2.generateAuthUrl({\n  scope: ['profile', 'email'],\n  access_type: 'offline',\n  prompt: 'consent',\n})\n\n// 2. \u91cd\u5b9a\u5411\u7528\u6237\u5230\u8ba4\u8bc1 URL\n// window.location.href = authUrl\n\n// 3. \u5904\u7406\u56de\u8c03\nasync function handleCallback(code: string) {\n  try {\n    const userInfo = await oauth2.getUserInfo({ code })\n    console.log('\u7528\u6237\u4fe1\u606f:', userInfo)\n    // \u5904\u7406\u7528\u6237\u4fe1\u606f...\n  } catch (error) {\n    console.error('\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25:', error)\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"recaptcha-\u9a8c\u8bc1",children:"reCAPTCHA \u9a8c\u8bc1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"import { GoogleCaptcha } from '@kazura/googleapis'\n\nconst captcha = new GoogleCaptcha(process.env.RECAPTCHA_SECRET_KEY)\n\nasync function verifyCaptcha(token: string, ip: string) {\n  try {\n    const result = await captcha.verify(token, ip)\n    if (result.success) {\n      console.log('\u9a8c\u8bc1\u6210\u529f')\n      return true\n    } else {\n      console.log('\u9a8c\u8bc1\u5931\u8d25:', result['error-codes'])\n      return false\n    }\n  } catch (error) {\n    console.error('\u9a8c\u8bc1\u8fc7\u7a0b\u51fa\u9519:', error)\n    return false\n  }\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},1427:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var s=r(7378);const l={},i=s.createContext(l);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);