"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5960],{3298:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"nestjs-redis","title":"NestJS Redis","description":"NestJS Redis \u662f\u4e00\u4e2a\u7528\u4e8e NestJS \u6846\u67b6\u7684 Redis \u6a21\u5757\uff0c\u5b83\u63d0\u4f9b\u4e86\u5bf9 Redis \u7684\u7b80\u5355\u96c6\u6210\u548c\u914d\u7f6e\u3002","source":"@site/docs/nestjs-redis.md","sourceDirName":".","slug":"/nestjs-redis","permalink":"/kazurajs/docs/nestjs-redis","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/nestjs-redis.md","tags":[],"version":"current","sidebarPosition":17,"frontMatter":{"sidebar_position":17},"sidebar":"tutorialSidebar","previous":{"title":"React Toolkit","permalink":"/kazurajs/docs/react-toolkit"},"next":{"title":"NestJS Winston","permalink":"/kazurajs/docs/nestjs-winston"}}');var r=s(6106),d=s(8018);const l={sidebar_position:17},t="NestJS Redis",o={},c=[{value:"\u7279\u6027",id:"\u7279\u6027",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:2},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:3},{value:"\u4f7f\u7528\u591a\u4e2a Redis \u5ba2\u6237\u7aef",id:"\u4f7f\u7528\u591a\u4e2a-redis-\u5ba2\u6237\u7aef",level:3},{value:"\u5f02\u6b65\u914d\u7f6e",id:"\u5f02\u6b65\u914d\u7f6e",level:3},{value:"API \u53c2\u8003",id:"api-\u53c2\u8003",level:2},{value:"RedisModule",id:"redismodule",level:3},{value:"register",id:"register",level:4},{value:"forRootAsync",id:"forrootasync",level:4},{value:"RedisService",id:"redisservice",level:3},{value:"getClient",id:"getclient",level:4},{value:"getClients",id:"getclients",level:4},{value:"\u7c7b\u578b\u5b9a\u4e49",id:"\u7c7b\u578b\u5b9a\u4e49",level:2},{value:"RedisModuleOptions",id:"redismoduleoptions",level:3},{value:"RedisModuleAsyncOptions",id:"redismoduleasyncoptions",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2},{value:"\u5728\u670d\u52a1\u4e2d\u4f7f\u7528 Redis",id:"\u5728\u670d\u52a1\u4e2d\u4f7f\u7528-redis",level:3},{value:"\u4f7f\u7528\u591a\u4e2a Redis \u5ba2\u6237\u7aef",id:"\u4f7f\u7528\u591a\u4e2a-redis-\u5ba2\u6237\u7aef-1",level:3},{value:"\u4f7f\u7528\u5f02\u6b65\u914d\u7f6e",id:"\u4f7f\u7528\u5f02\u6b65\u914d\u7f6e",level:3},{value:"\u4f7f\u7528\u5ba2\u6237\u7aef\u5c31\u7eea\u56de\u8c03",id:"\u4f7f\u7528\u5ba2\u6237\u7aef\u5c31\u7eea\u56de\u8c03",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"nestjs-redis",children:"NestJS Redis"})}),"\n",(0,r.jsx)(n.p,{children:"NestJS Redis \u662f\u4e00\u4e2a\u7528\u4e8e NestJS \u6846\u67b6\u7684 Redis \u6a21\u5757\uff0c\u5b83\u63d0\u4f9b\u4e86\u5bf9 Redis \u7684\u7b80\u5355\u96c6\u6210\u548c\u914d\u7f6e\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u7279\u6027",children:"\u7279\u6027"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u652f\u6301\u591a\u4e2a Redis \u5ba2\u6237\u7aef"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301\u540c\u6b65\u548c\u5f02\u6b65\u914d\u7f6e"}),"\n",(0,r.jsx)(n.li,{children:"\u63d0\u4f9b\u5b8c\u6574\u7684 TypeScript \u7c7b\u578b\u652f\u6301"}),"\n",(0,r.jsx)(n.li,{children:"\u57fa\u4e8e ioredis \u5ba2\u6237\u7aef"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301\u81ea\u5b9a\u4e49\u5ba2\u6237\u7aef\u914d\u7f6e"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install @kazura/nestjs-redis\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,r.jsx)(n.h3,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common'\nimport { RedisModule } from '@kazura/nestjs-redis'\n\n@Module({\n  imports: [\n    RedisModule.register({\n      host: 'localhost',\n      port: 6379,\n    }),\n  ],\n})\nexport class AppModule {}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528\u591a\u4e2a-redis-\u5ba2\u6237\u7aef",children:"\u4f7f\u7528\u591a\u4e2a Redis \u5ba2\u6237\u7aef"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common'\nimport { RedisModule } from '@kazura/nestjs-redis'\n\n@Module({\n  imports: [\n    RedisModule.register([\n      {\n        name: 'client1',\n        host: 'localhost',\n        port: 6379,\n      },\n      {\n        name: 'client2',\n        host: 'localhost',\n        port: 6380,\n      },\n    ]),\n  ],\n})\nexport class AppModule {}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5f02\u6b65\u914d\u7f6e",children:"\u5f02\u6b65\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common'\nimport { RedisModule } from '@kazura/nestjs-redis'\nimport { ConfigService } from '@nestjs/config'\n\n@Module({\n  imports: [\n    RedisModule.forRootAsync({\n      imports: [ConfigModule],\n      useFactory: (configService: ConfigService) => ({\n        host: configService.get('REDIS_HOST'),\n        port: configService.get('REDIS_PORT'),\n      }),\n      inject: [ConfigService],\n    }),\n  ],\n})\nexport class AppModule {}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"api-\u53c2\u8003",children:"API \u53c2\u8003"}),"\n",(0,r.jsx)(n.h3,{id:"redismodule",children:"RedisModule"}),"\n",(0,r.jsx)(n.h4,{id:"register",children:"register"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"static register(options: RedisModuleOptions | RedisModuleOptions[]): DynamicModule\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6ce8\u518c Redis \u6a21\u5757\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"options"}),": Redis \u914d\u7f6e\u9009\u9879\u6216\u914d\u7f6e\u9009\u9879\u6570\u7ec4"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u52a8\u6001\u6a21\u5757"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"forrootasync",children:"forRootAsync"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"static forRootAsync(options: RedisModuleAsyncOptions): DynamicModule\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f02\u6b65\u6ce8\u518c Redis \u6a21\u5757\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"options"}),": \u5f02\u6b65\u914d\u7f6e\u9009\u9879","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"imports"}),": \u5bfc\u5165\u7684\u6a21\u5757"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useClass"}),": \u914d\u7f6e\u5de5\u5382\u7c7b"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useFactory"}),": \u914d\u7f6e\u5de5\u5382\u51fd\u6570"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"inject"}),": \u6ce8\u5165\u7684\u4f9d\u8d56"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u52a8\u6001\u6a21\u5757"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"redisservice",children:"RedisService"}),"\n",(0,r.jsx)(n.h4,{id:"getclient",children:"getClient"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"getClient(name?: string): Redis\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u83b7\u53d6 Redis \u5ba2\u6237\u7aef\u5b9e\u4f8b\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"name"}),": \u5ba2\u6237\u7aef\u540d\u79f0\uff08\u53ef\u9009\uff09"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Redis \u5ba2\u6237\u7aef\u5b9e\u4f8b"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"getclients",children:"getClients"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"getClients(): Map<string, Redis>\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u83b7\u53d6\u6240\u6709 Redis \u5ba2\u6237\u7aef\u5b9e\u4f8b\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Redis \u5ba2\u6237\u7aef\u5b9e\u4f8b\u6620\u5c04"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u7c7b\u578b\u5b9a\u4e49",children:"\u7c7b\u578b\u5b9a\u4e49"}),"\n",(0,r.jsx)(n.h3,{id:"redismoduleoptions",children:"RedisModuleOptions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface RedisModuleOptions extends RedisOptions {\n  name?: string\n  url?: string\n  onClientReady?: (client: Redis) => void\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"redismoduleasyncoptions",children:"RedisModuleAsyncOptions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface RedisModuleAsyncOptions extends Pick<ModuleMetadata, 'imports'> {\n  useClass?: Type<RedisOptionsFactory>\n  useFactory?: (\n    ...args: any[]\n  ) =>\n    | RedisModuleOptions\n    | RedisModuleOptions[]\n    | Promise<RedisModuleOptions>\n    | Promise<RedisModuleOptions[]>\n  inject?: any[]\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u786e\u4fdd Redis \u670d\u52a1\u5668\u5df2\u7ecf\u542f\u52a8\u5e76\u53ef\u8bbf\u95ee"}),"\n",(0,r.jsx)(n.li,{children:"\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u914d\u7f6e Redis \u8fde\u63a5\u4fe1\u606f"}),"\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528\u591a\u4e2a\u5ba2\u6237\u7aef\u65f6\uff0c\u9700\u8981\u4e3a\u6bcf\u4e2a\u5ba2\u6237\u7aef\u6307\u5b9a\u552f\u4e00\u7684\u540d\u79f0"}),"\n",(0,r.jsx)(n.li,{children:"\u5efa\u8bae\u4f7f\u7528\u5f02\u6b65\u914d\u7f6e\u6765\u7ba1\u7406\u654f\u611f\u4fe1\u606f"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,r.jsx)(n.h3,{id:"\u5728\u670d\u52a1\u4e2d\u4f7f\u7528-redis",children:"\u5728\u670d\u52a1\u4e2d\u4f7f\u7528 Redis"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@nestjs/common'\nimport { RedisService } from '@kazura/nestjs-redis'\n\n@Injectable()\nexport class UserService {\n  constructor(private readonly redisService: RedisService) {}\n\n  async getUserCache(userId: string) {\n    const redis = this.redisService.getClient()\n    return redis.get(`user:${userId}`)\n  }\n\n  async setUserCache(userId: string, data: any) {\n    const redis = this.redisService.getClient()\n    await redis.set(`user:${userId}`, JSON.stringify(data))\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528\u591a\u4e2a-redis-\u5ba2\u6237\u7aef-1",children:"\u4f7f\u7528\u591a\u4e2a Redis \u5ba2\u6237\u7aef"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@nestjs/common'\nimport { RedisService } from '@kazura/nestjs-redis'\n\n@Injectable()\nexport class CacheService {\n  constructor(private readonly redisService: RedisService) {}\n\n  async getCache(key: string) {\n    const cacheClient = this.redisService.getClient('cache')\n    return cacheClient.get(key)\n  }\n\n  async getSession(key: string) {\n    const sessionClient = this.redisService.getClient('session')\n    return sessionClient.get(key)\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528\u5f02\u6b65\u914d\u7f6e",children:"\u4f7f\u7528\u5f02\u6b65\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common'\nimport { RedisModule } from '@kazura/nestjs-redis'\nimport { ConfigModule, ConfigService } from '@nestjs/config'\n\n@Module({\n  imports: [\n    ConfigModule.forRoot(),\n    RedisModule.forRootAsync({\n      imports: [ConfigModule],\n      useFactory: (configService: ConfigService) => ({\n        host: configService.get('REDIS_HOST'),\n        port: configService.get('REDIS_PORT'),\n        password: configService.get('REDIS_PASSWORD'),\n        db: configService.get('REDIS_DB'),\n        keyPrefix: configService.get('REDIS_PREFIX'),\n      }),\n      inject: [ConfigService],\n    }),\n  ],\n})\nexport class AppModule {}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528\u5ba2\u6237\u7aef\u5c31\u7eea\u56de\u8c03",children:"\u4f7f\u7528\u5ba2\u6237\u7aef\u5c31\u7eea\u56de\u8c03"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common'\nimport { RedisModule } from '@kazura/nestjs-redis'\n\n@Module({\n  imports: [\n    RedisModule.register({\n      host: 'localhost',\n      port: 6379,\n      onClientReady: (client) => {\n        client.on('error', (err) => {\n          console.error('Redis client error:', err)\n        })\n        client.on('connect', () => {\n          console.log('Redis client connected')\n        })\n      },\n    }),\n  ],\n})\nexport class AppModule {}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8018:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>t});var i=s(7378);const r={},d=i.createContext(r);function l(e){const n=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);